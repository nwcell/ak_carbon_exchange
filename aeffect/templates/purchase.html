<!DOCTYPE html>

<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />

  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width" />

  <title>Alaska Carbon Exchange :: Purchase </title>

  <!-- Included CSS Files (Uncompressed) -->
  <!--
  <link rel="stylesheet" href="/stylesheets/foundation.css">
  -->
  
  <!-- Included CSS Files (Compressed) -->
  <link rel="stylesheet" href="/stylesheets/app.css">
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />

  <script src="/javascripts/foundation/modernizr.foundation.js"></script>
</head>
<body>

  <!-- Header and Nav -->

  <nav class="top-bar">
    <ul>
      <!-- Title Area -->
      <li class="name">
        <h1>
          <a href="/">
            <span id="ihateyou">Alaska Carbon Exchange</span>
          </a>
        </h1>
      </li>
      <li class="toggle-topbar"><a href="#"></a></li>
    </ul>

    <section>
      <!-- Left Nav Section -->
      <ul class="left">
        <li class="divider"></li>
      </ul>

      <!-- Right Nav Section -->
      <ul class="right">
        <li class="divider"></li>
        <li>
          {% if handler.session.get('user') %}
          <a href="{{ handler.reverse_url('logout') }}">Log Out</a>
          {% else %}
          <a href="{{ handler.reverse_url('login') }}">Log In</a>
          {% end %}
        </li>
      </ul>
    </section>
  </nav>


  <!-- End Header and Nav -->


<div class="eleven centered columns">


  <div class="panel">
    <h3>Just a few clicks away!</h3>
    <h5 class="subheader">Click away! It's fun and easy!</h5>
    <a class="button" href="forms.php">Maybe I should call somebody for more info? &raquo;</a>
    <a class="button" href="forms.php">Oh look another button &raquo;</a>
  </div>

<div class="row panel">

<form action="" method="POST" id="payment-form">
          {% raw xsrf_form_html() %}
    <h1>Purchase</h1>

    <label>Purchase Amount ($USD) Use the slider or manually enter an amount</label>
    <div class="row">
      <div class="eight columns">
        <div style="padding-top: 10px;"><div id="slider-range-max"></div></div>
      </div>
      <div class="four columns">
        <input type="text" name='amount' id="amount"/>
      </div>
    </div>

    <label>Purchase Frequency (Subscription)</label>

    <div class="row">
      <div class="four columns">
        <select name='frequency'>
          <option value="0">Once</option>
          <option value="1">1 Year</option>
          <option value="2">2 Year</option>
          <option value="3">3 Year</option>
          <option value="4">4 Year</option>
          <option value="5">5 Year</option>
          <option value="10">10 Year</option>
          <option value="25">25 Year</option>
          <option value="50">50 Year</option>
          <option value="75">75 Year</option>
          <option value="100">100 Year</option>
        </select>
      </div>
    </div>

    &nbsp;
    <label>Card Number</label>

    <div class="row">
      <div class="eight columns">
        <input type="text" value="4242-4242-4242-4242" placeholder="XXXX-XXXX-XXXX-XXXX" size="20" autocomplete="off" class="card-number">
        <small class='error' id='card-number-error' style='display: none'></small>
      </div>
      <div class="four columns">
        <input type="text" value="623" placeholder="CVC" size="4" autocomplete="off" class="card-cvc">
        <small class='error' id='card-cvc-error' style='display: none'></small>
      </div>
    </div>

    <label>Expiration Date (MM/YYYY)</label>

    <div class="row">
      <div class="eight columns">
        <input type="text" value="11" placeholder="MM" size="2" class="card-expiry-month">
        <small class='error' id='card-expiry-month' style='display: none'></small>
      </div>
      <div class="four columns">
        <input type="text" value="2013" placeholder="YYYY" size="4" class="card-expiry-year">
        <small class='error' id='card-expiry-year' style='display: none'></small>
      </div>
    </div>

    <button type="submit" class="submit-button button">Submit Payment</button>

</form>

</div>


</div>
  <!-- End Grid Section -->

  <!-- Footer -->

  <footer class="row">
    <div class="twelve columns">
      <hr />
      <div class="row">
        <div class="six columns">
          <p>&copy; Copyright no one at all. Go to town.</p>
        </div>
        <div class="six columns">
          <ul class="link-list right">
            <li><a href="#">Section 1</a></li>
            <li><a href="#">Section 2</a></li>
            <li><a href="#">Section 3</a></li>
            <li><a href="#">Section 4</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  <!-- Included JS Files (Uncompressed) -->

  <script src="/javascripts/foundation/jquery.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.mediaQueryToggle.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.forms.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.reveal.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.orbit.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.navigation.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.buttons.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.tabs.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.tooltips.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.accordion.js"></script>
  
  <script src="/javascripts/foundation/jquery.placeholder.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.alerts.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.topbar.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.joyride.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.clearing.js"></script>
  
  <script src="/javascripts/foundation/jquery.foundation.magellan.js"></script>
  
  
  <!-- Included JS Files (Compressed) -->

  <!--
  
  <script src="/javascripts/foundation/jquery.js"></script>
  <script src="/javascripts/foundation/foundation.min.js"></script>

  -->
  
  <!-- Initialize JS Plugins -->
  <script src="/javascripts/foundation/app.js"></script>

  <!-- <script src="/javascripts/gmap3.js"></script> -->

  <!-- <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> -->

  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=visualization"></script>

  <script src="/javascripts/jquery.ui.map.js"></script>
  <script src="/javascripts/jquery.mustache.js"></script>
  <script src="/javascripts/jquery.currency.js"></script>

  <script type="text/javascript" src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>

  <script type="text/javascript" src="https://js.stripe.com/v1/"></script>

  <script type="text/javascript">

    Stripe.setPublishableKey('pk_test_wA2dmuQm8cOPsfdUOGfOLrbf');

    function stripeResponseHandler(status, response) {
                if (response.error) {
                    jQuery("#card-number-error").hide();
                    // re-enable the submit button
                    jQuery('.submit-button').removeAttr("disabled");
                    // show the errors on the form
                    console.log(response.error)
                    jQuery("#card-number-error").html(response.error.message);
                    jQuery("#card-number-error").show();
                } else {
                    var form$ = jQuery("#payment-form");
                    // token contains id, last4, and card type
                    var token = response['id'];
                    // insert the token into the form so it gets submitted to the server
                    form$.append("<input type='hidden' name='stripeToken' value='" + token + "' />");
                    // and submit
                    form$.get(0).submit();
                }
    }

    $.noConflict();
    
// Load Function
jQuery(function () {

   jQuery( "#slider-range-max" ).slider({
            range: "max",
            min: 200,
            max: 100000,
            value: 200,
            step: 100,
            slide: function( event, ui ) {
                jQuery( "#amount" ).val( ui.value );
                jQuery( "#amount" ).currency();
            }
        });
        jQuery( "#amount" ).val( jQuery( "#slider-range-max" ).slider( "value" ) );

    jQuery( "#amount" ).currency();

    console.log('hi');

    jQuery("#payment-form").submit(function(event) {
    // disable the submit button to prevent repeated clicks
    jQuery('.submit-button').attr("disabled", "disabled");

    Stripe.createToken({
        number: jQuery('.card-number').val(),
        cvc: jQuery('.card-cvc').val(),
        exp_month: jQuery('.card-expiry-month').val(),
        exp_year: jQuery('.card-expiry-year').val()
    }, stripeResponseHandler);

    // prevent the form from submitting with the default action
    return false;
  });

});    
    
  </script>


</body>
</html>
