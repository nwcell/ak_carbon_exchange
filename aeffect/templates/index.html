<!DOCTYPE html>

<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />

  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width" />

  <title>Welcome to Foundation | Grid</title>

  <!-- Included CSS Files (Uncompressed) -->
  <!--
  <link rel="stylesheet" href="stylesheets/foundation.css">
  -->
  
  <!-- Included CSS Files (Compressed) -->
  <link rel="stylesheet" href="stylesheets/app.css">

  <script src="javascripts/foundation/modernizr.foundation.js"></script>
</head>
<body>

  <!-- Header and Nav -->

  <nav class="top-bar">
    <ul>
      <!-- Title Area -->
      <li class="name">
        <h1>
          <a href="#">
            <span id="ihateyou">Alaska Carbon Exchange</span>
          </a>
        </h1>
      </li>
      <li class="toggle-topbar"><a href="#"></a></li>
    </ul>

    <section>
      <!-- Left Nav Section -->
      <ul class="left">
        <li class="divider"></li>
        <li class="has-dropdown">
          <a class="active" href="#">Regions</a>
          <ul class="dropdown">
            <li><label>Section Name</label></li>
            <li><a href="#" class="">Dropdown Level 1</a></li>
            <li><a href="#">Dropdown Option</a></li>
            <li><a href="#">Dropdown Option</a></li>
            <li class="divider"></li>
            <li><label>Section Name</label></li>
            <li><a href="#">Dropdown Option</a></li>
            <li><a href="#">Dropdown Option</a></li>
            <li><a href="#">Dropdown Option</a></li>
            <li class="divider"></li>
            <li><a href="#">See all &rarr;</a></li>
          </ul>
        </li>
        <li class="divider"></li>
        <li><a href="#">Visible Regions</a></li>
        <li class="divider"></li>
        <li class="search">
          <a href="#">Search</a>
        </li>
        <li class="divider"></li>
      </ul>

      <!-- Right Nav Section -->
      <ul class="right">
        <li class="divider"></li>
        <li class="has-dropdown">
          <a href="#">Main Item 4</a>
          <ul class="dropdown">
            <li><label>Section Name</label></li>
            <li class="has-dropdown">
              <a href="#" class="">Has Dropdown, Level 1</a>
              <ul class="dropdown">
                <li><a href="#">Dropdown Options</a></li>
                <li><a href="#">Dropdown Options</a></li>
                <li class="has-dropdown">
                  <a href="#">Has Dropdown, Level 2</a>
                  <ul class="dropdown test">
                    <li><a href="#">Subdropdown Option</a></li>
                    <li><a href="#">Subdropdown Option</a></li>
                    <li><a href="#">Subdropdown Option</a></li>
                  </ul>
                </li>
                <li><a href="#">Subdropdown Option</a></li>
                <li><a href="#">Subdropdown Option</a></li>
                <li><a href="#">Subdropdown Option</a></li>
              </ul>
            </li>
            <li><a href="#">Dropdown Option</a></li>
            <li><a href="#">Dropdown Option</a></li>
            <li class="divider"></li>
            <li><label>Section Name</label></li>
            <li><a href="#">Dropdown Option</a></li>
            <li><a href="#">Dropdown Option</a></li>
            <li><a href="#">Dropdown Option</a></li>
            <li class="divider"></li>
            <li><input type="search"></li>
          </ul>
        </li>
        <li class="divider"></li>
          <li class="search">
              <form action="asdf">
                <input type="search">
              </form>
          </li>
            <li class="has-button">
          </li>
        <li class="divider"></li>
        <li>
          <a href="/">Login</a>
        </li>
      </ul>
    </section>
  </nav>


  <!-- End Header and Nav -->

  <div id="map_canvas" style="height: 400px;"></div>

  <ul class="breadcrumbs">
      <li><a href="#">Home</a></li>
      <li><a href="#">Regions</a></li>
      <li class="current"><a href="#" id="state">State</a></li>
      <li class="unavailable"><a href="#" id="region">Please select a region by clicking on it on the map or from the upper menu</a></li>
  </ul>

  <!-- Main Grid Section -->

  <div class="row">

    <div class="three columns">
      <div class="panel">
        <h5>Panel Title</h5>
        <p>This is a three columns grid panel with an arbitrary height.</p>
      </div>
    </div>
    <div class="six columns">
      <div class="panel">
        <h5>Panel Title</h5>
        <p>This is a six columns grid panel with an arbitrary height. Bacon ipsum dolor sit amet salami ham hock biltong ball tip drumstick sirloin pancetta meatball short loin.</p>
      </div>
    </div>
    <div class="three columns">
      <div class="panel">
        <h5>Panel Title</h5>
        <p>This is a three columns grid panel with an arbitrary height.</p>
      </div>
    </div>

  </div>



  <div class="row">

    <div class="six columns">
      <div class="panel">
        <h5>Panel Title</h5>
        <p>This is a six columns grid panel with an arbitrary height. Bacon ipsum dolor sit amet salami ham hock biltong ball tip drumstick sirloin pancetta meatball short loin.</p>
      </div>
    </div>
    <div class="two columns">
      <div class="panel">
        <p>
          <img src="http://placehold.it/200x200" />
        </p>
      </div>
    </div>
    <div class="four columns">
      <div class="panel">
        <h5>Panel Title</h5>
        <p>This is a four columns grid panel with an arbitrary height. Bacon ipsum dolor sit amet salami.</p>
      </div>
    </div>

  </div>


  <div class="row">

    <div class="four columns">
      <div class="panel">
        <p>
          <img src="http://placehold.it/400x300" />
        </p>
      </div>
    </div>
    <div class="four columns">
      <div class="panel">
        <p>
          <img src="http://placehold.it/400x300" />
        </p>
      </div>
    </div>
    <div class="four columns">
      <div class="panel">
        <p>
          <img src="http://placehold.it/400x300" />
        </p>
      </div>
    </div>

  </div>


  <div class="row">

    <div class="six columns">
      <div class="panel">
        <h5>Panel Title</h5>
        <p>This is a six columns grid panel with an arbitrary height. Bacon ipsum dolor sit amet salami ham hock biltong ball tip drumstick sirloin pancetta meatball short loin.</p>
      </div>
    </div>
    <div class="three columns">
      <div class="panel">
        <h5>Panel Title</h5>
        <p>This is a three columns grid panel with an arbitrary height.</p>
      </div>
    </div>
    <div class="three columns">
      <div class="panel">
        <h5>Panel Title</h5>
        <p>This is a three columns grid panel with an arbitrary height.</p>
      </div>
    </div>

  </div>

  <!-- End Grid Section -->



  <!-- Footer -->

  <footer class="row">
    <div class="twelve columns">
      <hr />
      <div class="row">
        <div class="six columns">
          <p>&copy; Copyright no one at all. Go to town.</p>
        </div>
        <div class="six columns">
          <ul class="link-list right">
            <li><a href="#">Section 1</a></li>
            <li><a href="#">Section 2</a></li>
            <li><a href="#">Section 3</a></li>
            <li><a href="#">Section 4</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  <!-- Included JS Files (Uncompressed) -->

  <script src="javascripts/foundation/jquery.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.mediaQueryToggle.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.forms.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.reveal.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.orbit.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.navigation.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.buttons.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.tabs.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.tooltips.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.accordion.js"></script>
  
  <script src="javascripts/foundation/jquery.placeholder.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.alerts.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.topbar.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.joyride.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.clearing.js"></script>
  
  <script src="javascripts/foundation/jquery.foundation.magellan.js"></script>
  
  
  <!-- Included JS Files (Compressed) -->

  <!--
  
  <script src="javascripts/foundation/jquery.js"></script>
  <script src="javascripts/foundation/foundation.min.js"></script>

  -->
  
  <!-- Initialize JS Plugins -->
  <script src="javascripts/foundation/app.js"></script>

  <!-- <script src="javascripts/gmap3.js"></script> -->

  <!-- <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> -->

  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=visualization"></script>

  <script src="javascripts/jquery.ui.map.js"></script>

  <script type="text/javascript">
    circles = 0
    var Rects = [];

function get_random_color() {
    var letters = '0123456789ABCDEF'.split('');
    var color = '#';
    for (var i = 0; i < 6; i++ ) { // >
        color += letters[Math.round(Math.random() * 15)];
    };
    return color;
};



    function myFunction(data) {
        circles = circles + 1
        var themap = jQuery('#map_canvas').gmap('get', 'map');
        
        cityCircle = new google.maps.Circle({
          strokeColor: "#FF0000",
          strokeOpacity: 0.8,
          strokeWeight: Math.random() * 20,
          fillColor: "#FF0000",
          fillOpacity: 0.1,
          map: themap,
          center: new google.maps.LatLng(34.052234 +  (Math.random() * 0.3), -118.243684 + (Math.random() * 0.3)),
          radius: 2000,
          bounds: true,
          clickable: true,
          url: "/#" + circles,
          _state: "Alaska",
        });

        //google.maps.event.addListener(cityCircle, 'mouseover', function() { this.setOptions({'strokeWeight': 20}); });
        //google.maps.event.addListener(cityCircle, 'mouseout', function() { this.setOptions({'strokeWeight': 2}); });
        google.maps.event.addListener(cityCircle, 'click', function(shape) { jQuery("#region").text(this.url); jQuery("#state").text(this._state); });

        if (data) {

            if (Rects) {
                for (i in Rects) {
                    Rects[i].setMap(null);
                }
            }
            Rects.length = 0;

            jQuery.each(data,function(idx, obj){

                var themap = jQuery('#map_canvas').gmap('get', 'map');

                //var swLatLng = new google.maps.LatLng(obj.bbox.s, obj.bbox.w);
                //var neLatLng = new google.maps.LatLng(obj.bbox.n, obj.bbox.e);
                //var rectBounds = new google.maps.LatLngBounds(swLatLng, neLatLng);
                //var ghRectangle = new google.maps.Rectangle({
                //    bounds: rectBounds,
                //    title:"Hello World!",
                //    //map: themap,
                //    strokeColor: "#000000",
                //    strokeOpacity: 1,
                //    strokeWeight: 2,
                //    fillOpacity: 0,
                //});

                //Rects.push(ghRectangle);                

                var that = this;
                //console.log(idx)
                //console.log(obj)
    
                
                if(obj.arg == true){
                    //console.log('argh');
                    var marker = new google.maps.Marker({
                        position: new google.maps.LatLng(obj.lat, obj.long),
                        map: themap,
                        title: obj.hash
                    });
                    Rects.push(marker);
                };
                

                if(obj.lot == true){
                    jQuery.each(obj.geom.outline.coordinates, function(idxx, objx){
                        var paths = [];
                        console.log('drawing ' + obj.region.slug)
                        jQuery.each(objx, function(idxxx, objxx){
                            paths.push(new google.maps.LatLng(objxx[1], objxx[0]));
                        });                    
    
                        var lotPolygon = new google.maps.Polygon({
                            paths: paths,
                            strokeColor: "#000000",
                            strokeOpacity: 0.8,
                            strokeWeight: 2,
                            fillColor: get_random_color(),
                            fillOpacity: 0.05,
                            that: that,
                            title: obj.hash,
                        });
    
                        google.maps.event.addListener(lotPolygon, 'click', function(shape) { jQuery("#region").text(this.that.region.slug); jQuery("#state").text(this.that.state); });
    
                        google.maps.event.addListener(lotPolygon, 'mouseover', function() { this.setOptions({'fillOpacity': .5}); });
                        google.maps.event.addListener(lotPolygon, 'mouseout', function() { this.setOptions({'fillOpacity': 0.05}); });
    
                        lotPolygon.setMap(themap);
                        //console.log('drawn')
                        Rects.push(lotPolygon);
                    });
                }

                /*
                if (obj.geom.centroid){
                    //console.log(obj.centroid);
                    // heatmapData.push(new google.maps.LatLng(obj.centroid.coordinates[1], obj.centroid.coordinates[0]));
                };
                */

            });
        };
    };

    $.noConflict();
    
    // Load Function
    jQuery(function () {
        jQuery('#map_canvas').gmap({ 'center': '64.735967,-151.262664', 'zoom': 6 }).bind(
            'init',
            function (event, map) {
                jQuery(map).idle(function () {
                    jQuery.getJSON('/jsontest', {'center': map.getCenter().toUrlValue(), 'bounds': map.getBounds().toUrlValue()}, function(data) { myFunction(data); });
                });
            }
        );
    });
    
  </script>

</body>
</html>
